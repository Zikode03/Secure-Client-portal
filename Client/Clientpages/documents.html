<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prospera – Documents</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

<style>
:root {
  --blue: #2563eb;
  --bg: #f5f7fb;
  --dark: #0f172a;
  --muted: #64748b;
  --border: #e5e7eb;
  --primary: #2563eb;     /* added for .tag.active consistency if needed */
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: var(--bg);
  height: 100vh;
  overflow: hidden;
}

/* LAYOUT */
.app-layout {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* SIDEBAR – fixed, non-scrolling */
.sidebar {
  width: 260px;
  background: linear-gradient(180deg, #0f172a, #020617);
  color: white;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
}

.sidebar-header {
  padding: 22px;
  display: flex;
  gap: 12px;
  align-items: center;
}

.sidebar-header i {
  font-size: 30px;
  color: #60a5fa;
}

.sidebar-header h1 {
  margin: 0;
  font-size: 16px;
}

.sidebar-header p {
  margin: 0;
  font-size: 12px;
  color: #94a3b8;
}

.nav {
  padding: 16px;
  flex: 1;
}

.nav a {
  display: flex;
  gap: 12px;
  align-items: center;
  padding: 12px 14px;
  border-radius: 10px;
  color: #cbd5f5;
  text-decoration: none;
  margin-bottom: 6px;
}

.nav a.active {
  background: var(--blue);
  color: white;
}

.nav a:hover {
  background: #1e293b;
}

.sidebar-footer {
  padding: 16px;
}

.user-box {
  background: #1e293b;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 12px;
}

.user-box p {
  margin: 2px 0;
  font-size: 13px;
}

.role {
  color: #60a5fa;
  font-size: 12px;
}

.logout {
  width: 100%;
  background: none;
  border: none;
  color: #cbd5f5;
  padding: 12px;
  border-radius: 10px;
  cursor: pointer;
  text-align: left;
}

.logout:hover {
  background: #1e293b;
}

/* MAIN SCROLLABLE AREA */
.main-content {
  flex: 1;
  overflow-y: auto;
  padding: 2rem;
}

/* CONTENT STYLES */
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.upload-btn {
  background: var(--blue);
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 0.95rem;
}

/* SEARCH & FILTERS */
.filters {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.search {
  position: relative;
}

.search input {
  width: 100%;
  padding: 0.75rem 1rem 0.75rem 3rem;
  border: 1px solid var(--border);
  border-radius: 0.75rem;
  font-size: 0.95rem;
}

.search i {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--muted);
}

.tags {
  display: flex;
  gap: 0.5rem;
  overflow-x: auto;
  padding-bottom: 0.5rem;
}

.tag {
  padding: 0.4rem 1rem;
  background: white;
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  font-size: 0.875rem;
  white-space: nowrap;
  cursor: pointer;
}

.tag.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

/* DOCUMENTS LIST */
.docs-card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  border: 1px solid var(--border);
}

.doc-item {
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 14px;
}

.doc-left {
  display: flex;
  gap: 14px;
}

.doc-left i {
  font-size: 30px;
  color: var(--blue);
}

.badges span {
  background: #eef2ff;
  color: var(--blue);
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 999px;
  margin-right: 6px;
}

.doc-actions button {
  border: 1px solid var(--border);
  background: white;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  margin-left: 8px;
}
</style>
</head>

<body>

<div class="app-layout">

  <!-- SIDEBAR – fixed on left -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <i class="fa-solid fa-shield-halved"></i>
      <div>
        <h1>Prospera</h1>
        <p>Secure Client Portal</p>
      </div>
    </div>

                <nav class="nav">
      <a href="Clientportal.html">
        <i class="fa fa-chart-line"></i> Dashboard
      </a>
      <a href="documents.html" class="active">
        <i class="fa fa-file"></i> Documents
      </a>
      <a href="clientrequest.html">
        <i class="fa fa-file-alt"></i> Requests
      </a>
      <a href="messages.html">
        <i class="fa fa-message"></i> Messages
      </a>
      <a href="settings.html">
        <i class="fa fa-gear"></i> Settings
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-box">
        <p><strong>John Doe</strong></p>
        <p>client@example.com</p>
        <p class="role">Client</p>
      </div>
      <button class="logout">
        <i class="fa fa-sign-out"></i> Logout
      </button>
    </div>
  </aside>

  <!-- SCROLLABLE MAIN CONTENT -->
  <main class="main-content">

    <div class="section-header">
      <div>
        <h2>Documents</h2>
        <p class="muted">Manage and access your secure documents</p>
      </div>
      <a href="upload.html" class="upload-btn">
        <i class="fa fa-upload"></i> Upload Document
      </a>
    </div>

    <div class="filters">
      <div class="search">
        <i class="fas fa-search"></i>
        <input placeholder="Search documents...">
      </div>
      <div class="tags">
        <button class="tag active" data-filter="all">All</button>
        <button class="tag" data-filter="tax returns">Tax Returns</button>
        <button class="tag" data-filter="bank statements">Bank Statements</button>
        <button class="tag" data-filter="financial statements">Financial Statements</button>
        <button class="tag" data-filter="payroll">Payroll</button>
      </div>
    </div>

    <div class="docs-card">
      <strong id="docCountLabel">0 Documents</strong>
      <div id="docsList"></div>

    </div>

  </main>

</div>

<script>
const API_BASE_URL = "http://localhost:4000/api";
const token = localStorage.getItem("authToken");
if (!token) window.location.href = "../Clientlogins/login.html";

function authHeaders() {
  return { "Content-Type": "application/json", Authorization: `Bearer ${token || ""}` };
}

let docs = [];
let activeFilter = "all";
const searchInput = document.querySelector(".search input");
const tags = document.querySelectorAll(".tag");
const docsList = document.getElementById("docsList");
const docCountLabel = document.getElementById("docCountLabel");

function bytes(n) {
  const b = Number(n || 0);
  if (b < 1024) return `${b} B`;
  if (b < 1024 * 1024) return `${(b / 1024).toFixed(1)} KB`;
  return `${(b / (1024 * 1024)).toFixed(1)} MB`;
}

function renderDocs() {
  const search = searchInput.value.toLowerCase().trim();
  const filtered = docs.filter((doc) => {
    const text = `${doc.name} ${doc.category}`.toLowerCase();
    const categoryOk =
      activeFilter === "all" ||
      doc.category.toLowerCase() === activeFilter ||
      doc.category.toLowerCase().includes(activeFilter) ||
      activeFilter.includes(doc.category.toLowerCase());
    return categoryOk && (!search || text.includes(search));
  });

  docCountLabel.textContent = `${filtered.length} Documents`;
  docsList.innerHTML = filtered.map((doc) => `
    <div class="doc-item">
      <div class="doc-left">
        <i class="fa fa-file-lines"></i>
        <div>
          <strong>${doc.name}</strong>
          <div class="badges">
            <span>${doc.category}</span>
            <span>${doc.status}</span>
            <span>${bytes(doc.sizeBytes)}</span>
          </div>
          <small>Uploaded on ${(doc.uploadedAt || "").slice(0, 10)}</small>
        </div>
      </div>
      <div class="doc-actions">
        <button data-view-id="${doc.id}"><i class="fa fa-eye"></i></button>
        <button data-download-id="${doc.id}"><i class="fa fa-download"></i> Download</button>
      </div>
    </div>
  `).join("");
}

async function loadDocs() {
  const response = await fetch(`${API_BASE_URL}/documents`, { headers: authHeaders() });
  if (!response.ok) return;
  const data = await response.json();
  docs = data.items || [];
  renderDocs();
}

searchInput.addEventListener("input", renderDocs);
tags.forEach((tag) => {
  tag.addEventListener("click", () => {
    tags.forEach((t) => t.classList.remove("active"));
    tag.classList.add("active");
    activeFilter = tag.dataset.filter;
    renderDocs();
  });
});

document.addEventListener("click", async (event) => {
  const downloadBtn = event.target.closest("[data-download-id]");
  if (downloadBtn) {
    const id = downloadBtn.getAttribute("data-download-id");
    const response = await fetch(`${API_BASE_URL}/documents/${encodeURIComponent(id)}/download-url`, { headers: authHeaders() });
    if (response.ok) {
      const data = await response.json();
      if (data.signedUrl) window.open(data.signedUrl, "_blank");
    }
    return;
  }
  const viewBtn = event.target.closest("[data-view-id]");
  if (viewBtn) {
    window.location.href = `../../Accountant/documentview.html?id=${encodeURIComponent(viewBtn.getAttribute("data-view-id"))}`;
  }
});

loadDocs();
</script>

</body>
</html>



