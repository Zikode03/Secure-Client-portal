<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile & Security | Prospera Secure Client Portal</title>


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
   /* ================= GLOBAL ================= */
    * { box-sizing: border-box; margin:0; padding:0; }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f8fafc;
      color: #0f172a;
    }

    a { text-decoration: none; color: inherit; }
    button { font-family: inherit; cursor: pointer; border: none; }

    .app-layout {
      display: flex;
      min-height: 100vh;
      width: 100%;
    }

    /* SIDEBAR ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬Ãƒâ€šÃ‚ÂÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡Ãƒâ€šÃ‚Â¬ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬Ãƒâ€šÃ‚ÂÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡Ãƒâ€šÃ‚Â¬ identical to messages.html */
    .sidebar {
      width: 260px;
      background: linear-gradient(180deg, #0f172a, #020617);
      color: white;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
    }

    .sidebar-header {
      padding: 22px;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .sidebar-header i {
      font-size: 30px;
      color: #60a5fa;
    }

    .sidebar-header h1 {
      font-size: 16px;
    }

    .sidebar-header p {
      font-size: 12px;
      color: #94a3b8;
    }

    .nav {
      padding: 16px;
      flex: 1;
    }

    .nav a {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 12px 14px;
      border-radius: 10px;
      color: #cbd5f5;
      text-decoration: none;
      margin-bottom: 6px;
    }

    .nav a:hover {
      background: #1e293b;
    }

    .nav a.active {
      background: #2563eb;
      color: white;
    }

    .sidebar-footer {
      padding: 16px;
    }

    .user-box {
      background: #1e293b;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 12px;
    }

    .user-box p {
      font-size: 13px;
    }

    .role {
      color: #60a5fa;
      font-size: 12px;
    }

    .logout {
      width: 100%;
      background: none;
      border: none;
      color: #cbd5f5;
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      text-align: left;
    }

    .logout:hover {
      background: #1e293b;
    }

    /* ================= MAIN CONTENT ================= */
    .page {
      flex: 1;
      margin-left: 260px;
      padding: 24px;
      overflow-y: auto;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .page-title h1 {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 4px;
    }

    .page-title p {
      color: #64748b;
    }

 
    :root {
      --primary: #1754cf;
      --bg-light: #f6f6f8;
      --text: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --card: #ffffff;
      --green: #10b981;
      --red: #ef4444;
    }

    .profile-card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      display: flex;
      align-items: center;
      gap: 24px;
      margin-top: 24px;
    }

    .avatar-lg {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 4px solid #f1f5f9;
    }

    .avatar-profile {
      background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuAsNL3y9TY4lsEXHLOREQ9JWyw7vHBnH7xz17MRc8Zt8nPNXOWCj6NXF0LHmhgUaIuN9L5wE6LKkxWtYkMVi8Lzt8rilvHGz5q8-NNTsuZgx6Lzc2Ps1ny-cmj9gxtBiPI6Rai_k1SP91ZUqlzKaYXgLsXxuYS4Uy7Wzc9M4eZB_J557lFrpozqwJk-hZxFqi5KjAfRD3aFOKKItZhoE-3J1Y7y8vLwErY5BK5ioegTkzbatnahl-_g9XjluJu8DlbTov1aBiBR7fk');
    }

    .profile-info .tier { color: var(--primary); font-weight: 600; }

    .tabs {
      display: flex;
      gap: 32px;
      border-bottom: 1px solid var(--border);
      margin-top: 30px;
    }

    .tabs button {
      background: none;
      font-weight: 700;
      color: var(--text-muted);
      padding-bottom: 14px;
    }

    .tabs button.active {
      color: var(--primary);
      border-bottom: 3px solid var(--primary);
    }

    .tab-panel { display: none; margin-top: 30px; }
    .tab-panel.active { display: block; }

    .grid, .security-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
    }

    .card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
    }

    .card-header {
      padding: 20px;
      font-weight: 700;
      border-bottom: 1px solid var(--border);
    }

    .card-body { padding: 20px; }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .form-group label { font-size: 13px; font-weight: 700; }

    .form-group input {
      width: 100%;
      margin-top: 6px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #f8fafc;
    }

    .full { grid-column: 1 / -1; }

    .form-footer {
      padding: 20px;
      background: #f8fafc;
      text-align: right;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 700;
    }

    .btn-primary:hover { background: #1347b8; }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    thead {
      background: #f8fafc;
    }

    thead th {
      text-align: left;
      padding: 12px 16px;
      font-weight: 600;
      color: #64748b;
      border-bottom: 1px solid #e2e8f0;
    }

    tbody td {
      padding: 14px 16px;
      border-bottom: 1px solid #f1f5f9;
    }

    tbody tr:hover {
      background: #f9fafb;
    }

    .flex-between { display: flex; justify-content: space-between; align-items: center; }
    .flex-align { display: flex; align-items: center; gap: 8px; }
    .flex-column { display: flex; flex-direction: column; gap: 24px; }

    .link-primary { color: var(--primary); font-weight: 700; font-size: 0.875rem; }
    .link-danger { color: var(--red); font-weight: 700; font-size: 0.875rem; }
    .link-muted { color: var(--text-muted); font-weight: 700; font-size: 0.875rem; pointer-events: none; }

    .status-dot {
      width: 10px;
      height: 10px;
      background: var(--green);
      border-radius: 50%;
    }

    .status-text {
      color: var(--green);
      font-weight: 700;
      font-size: 0.8125rem;
      text-transform: uppercase;
    }

    .method-item {
      display: flex;
      gap: 16px;
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
    }

    .method-icon {
      width: 40px;
      height: 40px;
      background: rgba(23,84,207,0.1);
      color: var(--primary);
      border-radius: 8px;
      display: grid;
      place-items: center;
    }

    .method-label {
      background: var(--primary);
      color: white;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 999px;
    }

    .device-item {
      padding: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
    }

    .device-icon {
      width: 48px;
      height: 48px;
      background: #f1f5f9;
      border-radius: 8px;
      display: grid;
      place-items: center;
      color: var(--text-muted);
    }

    .current-badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(16,185,129,0.15);
      color: var(--green);
      font-weight: 600;
    }

    .btn-unlink {
      padding: 4px 12px;
      border: 1px solid #fecaca;
      color: var(--red);
      background: transparent;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 700;
    }

    .sidebar-card {
      background: rgba(23,84,207,0.05);
      border: 1px solid rgba(23,84,207,0.15);
      border-radius: 12px;
      padding: 24px;
    }

    .progress-bar {
      height: 8px;
      background: #e2e8f0;
      border-radius: 999px;
      overflow: hidden;
      margin: 12px 0;
    }

    .progress-fill {
      height: 100%;
      width: 85%;
      background: var(--primary);
    }

    @media (max-width: 900px) {
      .grid, .security-grid { grid-template-columns: 1fr; }
      .profile-card { flex-direction: column; text-align: center; }
      .page { margin-left: 0; padding: 16px; }
      .sidebar { position: relative; width: 100%; height: auto; }
    }
  </style>
</head>

<body>

<div class="app-layout">

  <!-- SIDEBAR ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬Ãƒâ€šÃ‚ÂÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡Ãƒâ€šÃ‚Â¬ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬Ãƒâ€šÃ‚ÂÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡Ãƒâ€šÃ‚Â¬ identical copy from messages.html -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <i class="fa-solid fa-shield-halved"></i>
      <div>
        <h1>Prospera</h1>
        <p>Secure Client Portal</p>
      </div>
    </div>

    <nav class="nav">
      <a href="Clientportal.html"><i class="fa fa-chart-line"></i> Dashboard</a>
      <a href="documents.html"><i class="fa fa-file"></i> Documents</a>
      <a href="clientrequest.html"><i class="fa fa-file-alt"></i> Requests</a>
      <a href="messages.html"><i class="fa fa-message"></i> Messages</a>
      <a href="settings.html" class="active"><i class="fa fa-gear"></i> Settings</a>
    </nav>

    <div class="sidebar-footer">
      <div class="user-box">
        <p><strong>John Doe</strong></p>
        <p>client@example.com</p>
        <p class="role">Client</p>
      </div>
      <button class="logout"><i class="fa fa-sign-out"></i> Logout</button>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="page">
    <div class="container">

      <div class="page-title">
        <h1>User Profile & Security</h1>
        <p>Manage your identity, security protocols, and login history.</p>
      </div>

      <!-- PROFILE CARD -->
      <div class="profile-card">
        <div class="avatar-lg avatar-profile"></div>
        <div class="profile-info">
          <h2>Alex Thompson</h2>
          <p class="tier">Client Account ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡Ãƒâ€šÃ‚Â¬ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¢ Premium Tier</p>
          <p>Member since January 2023</p>
        </div>
      </div>

      <!-- TABS -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="profile">Personal Information</button>
        <button class="tab-btn" data-tab="security">Security Settings</button>
      </div>

      <!-- PROFILE TAB -->
      <div class="tab-panel active" id="profile">
        <div class="grid">
          <!-- Left column -->
          <div>
            <!-- Account Details -->
            <div class="card">
              <div class="card-header">Account Details</div>
              <div class="card-body">
                <div class="form-grid">
                  <div class="form-group">
                    <label>First Name</label>
                    <input id="firstNameInput" value="Alex">
                  </div>
                  <div class="form-group">
                    <label>Last Name</label>
                    <input id="lastNameInput" value="Thompson">
                  </div>
                  <div class="form-group full">
                    <label>Email Address</label>
                    <input id="emailInput" value="alex.thompson@example.com">
                  </div>
                  <div class="form-group full">
                    <label>Phone Number</label>
                    <input id="phoneInput" value="+1 (555) 000-0000">
                  </div>
                </div>
              </div>
              <div class="form-footer">
                <button class="btn-primary" id="saveProfileBtn">Save Changes</button>
              </div>
            </div>

            <br>

            <!-- Login Activity -->
            <div class="card">
              <div class="card-header">Recent Login Activity</div>
              <div class="card-body">
                <table>
                  <thead>
                    <tr>
                      <th>Device</th>
                      <th>Location</th>
                      <th>IP</th>
                      <th>Time</th>
                    </tr>
                  </thead>
                  <tbody id="loginActivityBody"></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Right column -->
          <div>
            <div class="sidebar-card">
              <h4>Security Score</h4>
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <p><strong>85% secure</strong></p>
            </div>
          </div>
        </div>
      </div>

      <!-- SECURITY TAB -->
      <div class="tab-panel" id="security">
        <div class="security-grid">
          <!-- Left column -->
          <div class="flex-column">
            <!-- Password -->
            <div class="card">
              <div class="card-header">Password Management</div>
              <div class="card-body flex-between">
                <div>
                  <div>Update Password</div>
                  <div class="link-muted">Last changed on <strong>October 12, 2023</strong></div>
                </div>
                <button class="btn-primary">Change Password</button>
              </div>
            </div>

            <!-- 2FA -->
            <div class="card">
              <div class="card-header flex-between">
                <div>
                  <div>Two-Factor Authentication (2FA)</div>
                  <div class="flex-align">
                    <span class="status-dot" id="twoFactorDot"></span>
                    <span class="status-text" id="twoFactorStatus">Active</span>
                  </div>
                </div>
                <a href="#" class="link-primary" id="generateBackupCodesBtn">Generate Backup Codes</a>
              </div>
              <div class="card-body flex-column">
                <div class="method-item">
                  <div class="method-icon"><i class="fa-solid fa-mobile-screen-button"></i></div>
                  <div>
                    <h4>Authenticator App <span class="method-label">Primary</span></h4>
                    <p class="link-muted">Google Authenticator, Authy, or Microsoft Authenticator.</p>
                    <div class="flex-align">
                      <a href="#" class="link-primary">Edit Method</a>
                      <a href="#" class="link-muted">Remove</a>
                    </div>
                  </div>
                </div>

                <div class="method-item">
                  <div class="method-icon"><i class="fa-solid fa-comment-sms"></i></div>
                  <div>
                    <h4>SMS Authentication</h4>
                    <p class="link-muted" id="smsMethodText">Receive a code via text message.</p>
                    <div class="flex-align">
                      <a href="#" class="link-primary">Edit Phone</a>
                      <a href="#" class="link-danger" id="deactivateSmsBtn">Deactivate</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Connected Devices -->
            <div class="card">
              <div class="card-header">Connected Devices</div>
              <div class="device-item">
                <div class="flex-align">
                  <div class="device-icon"><i class="fa-solid fa-desktop"></i></div>
                  <div>
                    <h4>Chrome on Windows <span class="current-badge">Current</span></h4>
                    <p class="link-muted">New York, NY ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡Ãƒâ€šÃ‚Â¬ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¢ 192.168.1.45</p>
                  </div>
                </div>
                <button class="btn-unlink" disabled>Unlink</button>
              </div>

              <div class="device-item">
                <div class="flex-align">
                  <div class="device-icon"><i class="fa-solid fa-mobile-screen"></i></div>
                  <div>
                    <h4>iPhone 13 - Safari</h4>
                    <p class="link-muted">New York, NY ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡Ãƒâ€šÃ‚Â¬ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¢ Last active 2 hours ago</p>
                  </div>
                </div>
                <button class="btn-unlink">Unlink</button>
              </div>

              <div class="device-item">
                <div class="flex-align">
                  <div class="device-icon"><i class="fa-solid fa-desktop"></i></div>
                  <div>
                    <h4>Edge on macOS</h4>
                    <p class="link-muted">London, UK ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã…Â¡Ãƒâ€šÃ‚Â¬ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â¢ Last active Oct 21</p>
                  </div>
                </div>
                <button class="btn-unlink">Unlink</button>
              </div>
            </div>
          </div>

          <!-- Right column -->
          <div class="flex-column">
            <div class="sidebar-card">
              <div class="flex-align">
                <i class="fa-solid fa-shield-halved"></i>
                <h4>Security Score</h4>
              </div>
              <div class="progress-bar"><div class="progress-fill"></div></div>
              <p><strong>Your profile is 85% secure</strong></p>
              <p class="link-muted">To reach 100%, update your password.</p>
              <button class="link-primary">Improve Security ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬Ãƒâ€šÃ‚Â ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬ÃƒÂ¢Ã¢â‚¬Å¾Ã‚Â¢</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<script src="../../shared/portal-config.js"></script>
<script src="../../shared/portal-auth.js"></script>
<script>
const API_BASE_URL = window.PortalConfig.API_BASE_URL;
const session = window.PortalAuth.requireRole("client", "../Clientlogins/login.html");
if (!session) { throw new Error("Unauthorized"); }
const { token } = session;

function authHeaders() {
  return window.PortalAuth.authHeaders(token);
}

const tabButtons = document.querySelectorAll(".tab-btn");

function showSettingsNotice(message, tone = "info") {
  let box = document.getElementById("settingsNotice");
  if (!box) {
    box = document.createElement("div");
    box.id = "settingsNotice";
    box.style.position = "fixed";
    box.style.right = "20px";
    box.style.bottom = "20px";
    box.style.padding = "12px 14px";
    box.style.borderRadius = "10px";
    box.style.fontSize = "13px";
    box.style.fontWeight = "600";
    box.style.zIndex = "9999";
    box.style.boxShadow = "0 10px 25px rgba(15,23,42,0.2)";
    document.body.appendChild(box);
  }

  const palettes = {
    success: { bg: "#ecfdf5", text: "#166534", border: "1px solid #86efac" },
    error: { bg: "#fef2f2", text: "#991b1b", border: "1px solid #fecaca" },
    info: { bg: "#eff6ff", text: "#1d4ed8", border: "1px solid #bfdbfe" },
  };

  const style = palettes[tone] || palettes.info;
  box.style.background = style.bg;
  box.style.color = style.text;
  box.style.border = style.border;
  box.textContent = message;
  box.style.display = "block";

  clearTimeout(showSettingsNotice._timer);
  showSettingsNotice._timer = setTimeout(() => {
    box.style.display = "none";
  }, 3500);
}
const tabPanels = document.querySelectorAll(".tab-panel");
tabButtons.forEach((btn) => {
  btn.addEventListener("click", () => {
    tabButtons.forEach((b) => b.classList.remove("active"));
    tabPanels.forEach((p) => p.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

async function loadProfile() {
  const response = await fetch(`${API_BASE_URL}/profile/me`, { headers: authHeaders() });
  if (!response.ok) return;
  const data = await response.json();
  document.getElementById("firstNameInput").value = data.profile.firstName || "";
  document.getElementById("lastNameInput").value = data.profile.lastName || "";
  document.getElementById("emailInput").value = data.profile.email || "";
  document.getElementById("phoneInput").value = data.profile.phone || "";
}

async function loadLoginActivity() {
  const response = await fetch(`${API_BASE_URL}/profile/login-activity`, { headers: authHeaders() });
  if (!response.ok) return;
  const data = await response.json();
  const body = document.getElementById("loginActivityBody");
  body.innerHTML = (data.items || []).map((item) => `
    <tr>
      <td>${item.device}</td>
      <td>${item.location}</td>
      <td>${item.ipAddress}</td>
      <td>${new Date(item.createdAt).toLocaleString()}</td>
    </tr>
  `).join("");
}

async function loadSecurity() {
  const response = await fetch(`${API_BASE_URL}/profile/security`, { headers: authHeaders() });
  if (!response.ok) return;
  const data = await response.json();
  const security = data.security || {};
  const enabled = Boolean(security.twoFactorEnabled);
  document.getElementById("twoFactorStatus").textContent = enabled ? "Active" : "Inactive";
  document.getElementById("twoFactorStatus").style.color = enabled ? "var(--green)" : "var(--red)";
  document.getElementById("twoFactorDot").style.background = enabled ? "var(--green)" : "var(--red)";
  document.getElementById("smsMethodText").textContent = security.smsEnabled
    ? "SMS authentication is enabled."
    : "SMS authentication is disabled.";
}

document.getElementById("saveProfileBtn").addEventListener("click", async () => {
  const payload = {
    firstName: document.getElementById("firstNameInput").value.trim(),
    lastName: document.getElementById("lastNameInput").value.trim(),
    email: document.getElementById("emailInput").value.trim(),
    phone: document.getElementById("phoneInput").value.trim(),
  };
  const response = await fetch(`${API_BASE_URL}/profile/me`, {
    method: "PATCH",
    headers: authHeaders(),
    body: JSON.stringify(payload),
  });
  if (response.ok) showSettingsNotice("Profile saved.", "success");
});

document.getElementById("generateBackupCodesBtn").addEventListener("click", async (event) => {
  event.preventDefault();
  const response = await fetch(`${API_BASE_URL}/profile/security/generate-backup-codes`, {
    method: "POST",
    headers: authHeaders(),
    body: "{}",
  });
  if (!response.ok) return;
  const data = await response.json();
  showSettingsNotice(`Backup codes: ${(data.codes || []).join(", ")}`, "info");
});

document.getElementById("deactivateSmsBtn").addEventListener("click", async (event) => {
  event.preventDefault();
  const response = await fetch(`${API_BASE_URL}/profile/security`, {
    method: "PATCH",
    headers: authHeaders(),
    body: JSON.stringify({ smsEnabled: false }),
  });
  if (response.ok) {
    loadSecurity();
  }
});

loadProfile();
loadLoginActivity();
loadSecurity();
</script>

</body>
</html>
